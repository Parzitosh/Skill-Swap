<%- include('partials/header', { title: 'My Requests' }) %>

<nav>
    <ul>
        <li><strong>SkillSwap</strong></li>
    </ul>
    <ul>
        <li><a href="/users/dashboard" class="secondary">Dashboard</a></li>
        <li><a href="/users/profile" class="secondary">My Profile</a></li>
        <li><a href="/users/requests" class="secondary">My Requests</a></li>
        <li><a href="/users/logout" role="button">Logout</a></li>
    </ul>
</nav>

<h1>My Requests</h1>

<article>
    <header><h2>Requests Received</h2></header>
    <% if (receivedRequests && receivedRequests.length > 0) { %>
        <ul>
            <% receivedRequests.forEach(request => { %>
                <li>
                    From: <strong><%= request.fromUser.name %></strong> | Status: <%= request.status %>
                    <% if (request.status === 'pending') { %>
                        <form action="/users/requests/<%= request._id %>/accept" method="POST" style="display: inline;">
                            <button type="submit" class="secondary">Accept</button>
                        </form>
                        <form action="/users/requests/<%= request._id %>/reject" method="POST" style="display: inline;">
                            <button type="submit" class="contrast">Reject</button>
                        </form>
                    <% } %>
                    <% if (request.status === 'accepted') { %>
                        <a href="/users/requests/<%= request._id %>/chat" role="button" class="outline">Enter Chat</a>
                        <details>
                            <summary role="button" class="secondary outline">Leave a Review</summary>
                            <%# In received requests, the person to review is always the 'fromUser' %>
                            <form action="/users/review/<%= request.fromUser._id %>/<%= request._id %>" method="POST">
                                <label for="rating">Rating (1-5)</label>
                                <input type="number" name="rating" min="1" max="5" required>
                                <label for="comment">Comment</label>
                                <textarea name="comment" required></textarea>
                                <button type="submit">Submit Review</button>
                            </form>
                        </details>
                    <% } %>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p>You have not received any requests.</p>
    <% } %>
</article>

<article>
    <header><h2>Requests Sent</h2></header>
    <% if (sentRequests && sentRequests.length > 0) { %>
        <ul>
            <% sentRequests.forEach(request => { %>
                <li>
                    To: <strong><%= request.toUser.name %></strong> | Status: <%= request.status %>
                    <% if (request.status === 'accepted') { %>
                        <a href="/users/requests/<%= request._id %>/chat" role="button" class="outline">Enter Chat</a>
                        <details>
                            <summary role="button" class="secondary outline">Leave a Review</summary>
                            <%# In sent requests, the person to review is always the 'toUser' %>
                            <form action="/users/review/<%= request.toUser._id %>/<%= request._id %>" method="POST">
                                <label for="rating">Rating (1-5)</label>
                                <input type="number" name="rating" min="1" max="5" required>
                                <label for="comment">Comment</label>
                                <textarea name="comment" required></textarea>
                                <button type="submit">Submit Review</button>
                            </form>
                        </details>
                    <% } %>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p>You have not sent any requests.</p>
    <% } %>
</article>

<%- include('partials/footer') %>